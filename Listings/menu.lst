C51 COMPILER V9.59.0.0   MENU                                                              01/30/2021 00:04:31 PAGE 1   


C51 COMPILER V9.59.0.0, COMPILATION OF MODULE MENU
OBJECT MODULE PLACED IN .\Objects\menu.obj
COMPILER INVOKED BY: D:\MDK5anzhuangwenjianjia\C51\BIN\C51.EXE menu.c OPTIMIZE(8,SPEED) BROWSE DEBUG OBJECTEXTEND PRINT(
                    -.\Listings\menu.lst) OBJECT(.\Objects\menu.obj)

line level    source

   1          #include <intrins.h>
   2          #include <stdio.h>
   3          #include "lcd.h"
   4          #include "menu.h"
   5          
   6          enum my_enum1{
   7              UP = 2, //
   8              DOWN = 3 //
   9          };
  10          
  11          struct date my_date = {
  12              /*  
  13                  闰年：是4的倍数而不是100的倍数 或是400的倍数
  14                  闰年2月29天 平年2月28天
  15               */
  16              2021, // 2020为闰年
  17              1,
  18              29,
  19                  
  20              23,
  21              59,
  22              50,
  23                  
  24              0, // is_leap_year = 1
  25              30, // 闰年2月29天
  26          
  27              5 // 2021-01-29 为周5
  28          
  29          };
  30          struct beep_time my_beep_time = {
  31                  0,
  32                  1,
  33              0, // is_beeping = 0;
  34              0 //整点:on_the_hour = 1
  35          };
  36          sbit key_break = P3^5;
  37          sbit value_up = P3^4;
  38          sbit value_down = P3^3;
  39          sbit key_star = P3^2;
  40          
  41          char str[10] = " ";
  42          uint8_t star_postion = 1;
  43          
  44          void key_init(){
  45   1          key_break = 1;
  46   1          value_up = 1;
  47   1          value_down = 1;
  48   1          key_star = 1;
  49   1      }
  50          uint8_t key_scan(bit key){
  51   1          if (key == 0)
  52   1          {
  53   2              /* code */
  54   2              delay(80);
C51 COMPILER V9.59.0.0   MENU                                                              01/30/2021 00:04:31 PAGE 2   

  55   2              if(key == 0)
  56   2                  return 0;
  57   2          }
  58   1          return 1;
  59   1      }
  60          void refresh_display(void){
  61   1          sprintf(str, "%04d", my_date.year);
  62   1          printf_str(1, 1, str);
  63   1          sprintf(str, "%02d", my_date.mounth);
  64   1          printf_str(2, 1, str);
  65   1          sprintf(str, "%02d", my_date.day);
  66   1          printf_str(3, 1, str);
  67   1      
  68   1          sprintf(str, "%02d", my_date.hour);
  69   1          printf_str(1, 5, str);
  70   1          sprintf(str, "%02d", my_date.minute);
  71   1          printf_str(2, 5, str);
  72   1          sprintf(str, "%02d", my_date.second);
  73   1          printf_str(3, 5, str);
  74   1      }
  75          /* 月份天数判断 */
  76          void set_mounth_days(void){
  77   1          /* 
  78   1              mounth_flag = 1: 大月 1 3 5 7 8 10 12
  79   1              2：2月 
  80   1              3：小月 4 6 9 11
  81   1           */
  82   1          uint8_t mounth_flag = 0;
  83   1          if(my_date.mounth <= 7){
  84   2              if(my_date.mounth % 2 == 1){
  85   3                  /* 大月 */
  86   3                  mounth_flag = 1;
  87   3              } else if(my_date.mounth == 2) {
  88   3                  /* 二月 */
  89   3                  mounth_flag = 2;
  90   3              } else {
  91   3                  /* 小月 */
  92   3                  mounth_flag = 3;
  93   3              }
  94   2          } else {
  95   2              if(my_date.mounth % 2 == 1){
  96   3                  /* 小月 */
  97   3                  mounth_flag = 3;
  98   3              } else {
  99   3                  /* 大月 */
 100   3                  mounth_flag = 1;
 101   3              }
 102   2          }
 103   1          switch (mounth_flag)
 104   1          {
 105   2              case 1:
 106   2              /* 大月 */
 107   2                  my_date.mounth_days = 31;
 108   2                  break;
 109   2              case 2:
 110   2              /* 二月 */
 111   2              if(my_date.is_leap_year == 1){ //闰年2月29天 平年2月28天
 112   3                  /* 闰年 */
 113   3                  my_date.mounth_days = 29;
 114   3              } else {
 115   3                  /* 平年 */
 116   3                  my_date.mounth_days = 28;
C51 COMPILER V9.59.0.0   MENU                                                              01/30/2021 00:04:31 PAGE 3   

 117   3              }
 118   2                  break;
 119   2              case 3:
 120   2              /* 小月 */
 121   2                  my_date.mounth_days = 30;
 122   2                  break;
 123   2              default:
 124   2                  break;
 125   2          }
 126   1      }
 127          void set_date(void){
 128   1              printf_str(0, 0, "修改时间");
 129   1          printf_str(1, 0, "年");
 130   1          sprintf(str, "%04d", my_date.year);
 131   1          printf_str(1, 1, str);
 132   1          printf_str(2, 0, "月");
 133   1          sprintf(str, "%02d", my_date.mounth);
 134   1          printf_str(2, 1, str);
 135   1          printf_str(3, 0, "日");
 136   1          sprintf(str, "%02d", my_date.day);
 137   1          printf_str(3, 1, str);
 138   1              
 139   1          printf_str(1, 4, "时");
 140   1          sprintf(str, "%02d", my_date.hour);
 141   1          printf_str(1, 5, str);
 142   1          printf_str(2, 4, "分");
 143   1          sprintf(str, "%02d", my_date.minute);
 144   1          printf_str(2, 5, str);
 145   1          printf_str(3, 4, "秒");
 146   1          sprintf(str, "%02d", my_date.second);
 147   1          printf_str(3, 5, str);
 148   1              
 149   1              printf_str(star_postion, 3, "*");
 150   1              
 151   1              star_postion = 1;
 152   1          while (1)
 153   1          {
 154   2              /* code */
 155   2              /* 改star * 的位置 */
 156   2              if (key_scan(key_star) == 0){
 157   3                  if(star_postion <= 3){
 158   4                      printf_str(star_postion, 3, " ");
 159   4                  } else if(star_postion >= 4){
 160   4                      printf_str(star_postion-3, 6, " ");
 161   4                  }
 162   3                  if (star_postion < 6)
 163   3                      star_postion ++;
 164   3                              else if (star_postion == 6)
 165   3                      star_postion = 1;
 166   3                  //printf_str(star_postion, 3, "*");
 167   3                  if(star_postion <= 3){
 168   4                      printf_str(star_postion, 3, "*");
 169   4                  } else if(star_postion >= 4){
 170   4                      printf_str(star_postion-3, 6, "*");
 171   4                  }
 172   3              }
 173   2              
 174   2              /* 改年月日 时分秒数值 */
 175   2              if (key_scan(value_up) == 0){
 176   3                  switch (star_postion)
 177   3                  {
 178   4                      /* 年月日 */
C51 COMPILER V9.59.0.0   MENU                                                              01/30/2021 00:04:31 PAGE 4   

 179   4                      case 1:
 180   4                          /* year */
 181   4                          my_date.year ++;
 182   4                          /*  
 183   4                              闰年：是4的倍数而不是100的倍数 或是400的倍数
 184   4                              闰年2月29天 平年2月28天
 185   4                          */
 186   4                          if((my_date.year%4 == 0 && my_date.year%100 != 0)|| my_date.year%400 == 0){
 187   5                              my_date.is_leap_year = 1;
 188   5                          } else {
 189   5                              my_date.is_leap_year =0;
 190   5                          }
 191   4                          break;
 192   4                      case 2:
 193   4                          /* mounth */
 194   4                          if(my_date.mounth == 12){
 195   5                              my_date.mounth = 1;
 196   5                          } else if(my_date.mounth < 12){
 197   5                              my_date.mounth ++;
 198   5                          }
 199   4                          /* 对月份进行判断，确定每月的天数 */
 200   4                          set_mounth_days();
 201   4                          break;
 202   4                      case 3:
 203   4                          /* day */
 204   4                          
 205   4                          if(my_date.day == my_date.mounth_days){
 206   5                              my_date.day = 1;
 207   5                          } else if(my_date.day < my_date.mounth_days){
 208   5                              my_date.day ++;
 209   5                          }
 210   4                          break;
 211   4                      /* 时分秒 */
 212   4                      case 4:
 213   4                          /* hour */
 214   4                          if(my_date.hour == 23){
 215   5                              my_date.hour = 0;
 216   5                          } else if(my_date.hour < 23){
 217   5                              my_date.hour ++;
 218   5                          }
 219   4                          break;
 220   4                      case 5:
 221   4                          /* minute */
 222   4                          if(my_date.minute == 59){
 223   5                              my_date.minute = 0;
 224   5                          } else if(my_date.minute < 59){
 225   5                              my_date.minute ++;
 226   5                          }
 227   4                          break;
 228   4                      case 6:
 229   4                          /* second */
 230   4                          if(my_date.second == 59){
 231   5                              my_date.second = 0;
 232   5                          } else if(my_date.second < 59){
 233   5                              my_date.second ++;
 234   5                          }
 235   4                          break;
 236   4                      default:
 237   4                          break;
 238   4                  }
 239   3                  refresh_display();
 240   3              } else if(key_scan(value_down) == 0){
C51 COMPILER V9.59.0.0   MENU                                                              01/30/2021 00:04:31 PAGE 5   

 241   3                  switch (star_postion)
 242   3                  {
 243   4                      case 1:
 244   4                          /* code */
 245   4                          if(my_date.year == 0){
 246   5                              my_date.year = 2020;
 247   5                          }
 248   4                          else{
 249   5                              my_date.year --;
 250   5                          }
 251   4                          if((my_date.year%4 == 0 && my_date.year%100 != 0)|| my_date.year%400 == 0){
 252   5                              my_date.is_leap_year = 1;
 253   5                          } else {
 254   5                              my_date.is_leap_year =0;
 255   5                          }
 256   4                          break;
 257   4                      case 2:
 258   4                          if(my_date.mounth == 1){
 259   5                              my_date.mounth = 12;
 260   5                          }
 261   4                          else{
 262   5                              my_date.mounth --;
 263   5                          }
 264   4                          set_mounth_days();
 265   4                          break;
 266   4                      case 3:
 267   4                          if(my_date.day == 1){
 268   5                              my_date.day = my_date.mounth_days;
 269   5                          }
 270   4                          else{
 271   5                              my_date.day --;
 272   5                          }
 273   4                          break;
 274   4                          /* 时分秒 */
 275   4                      case 4:
 276   4                          /* hour */
 277   4                          if(my_date.hour > 0){
 278   5                              my_date.hour --;
 279   5                          } else if(my_date.hour == 0){
 280   5                              my_date.hour = 23;
 281   5                          }
 282   4                          break;
 283   4                      case 5:
 284   4                          /* minute */
 285   4                          if(my_date.minute > 0){
 286   5                              my_date.minute --;
 287   5                          }
 288   4                          else if(my_date.minute == 0){
 289   5                              my_date.minute = 59;
 290   5                          } 
 291   4                          break;
 292   4                      case 6:
 293   4                          /* second */
 294   4                          if(my_date.second > 0){
 295   5                              my_date.second --;
 296   5                          } else if(my_date.second == 0){
 297   5                              my_date.second = 59;
 298   5                          }
 299   4                          break;
 300   4                      default:
 301   4                          break;
 302   4                  }
C51 COMPILER V9.59.0.0   MENU                                                              01/30/2021 00:04:31 PAGE 6   

 303   3                  refresh_display();
 304   3              }
 305   2             if (key_scan(key_break) == 0){
 306   3                 break;
 307   3             }
 308   2          }
 309   1              // ET0 = 1; //enable timer1 interrupt
 310   1          // EA = 1; //open global interrupt switch
 311   1      }
 312          void beep_time(){
 313   1          printf_str(0, 0, "定时设置");
 314   1          
 315   1          printf_str(1, 2, "时");
 316   1          sprintf(str, "%02d", my_beep_time.hour);
 317   1          printf_str(1, 5, str);
 318   1          printf_str(2, 2, "分");
 319   1          sprintf(str, "%02d", my_beep_time.minute);
 320   1          printf_str(2, 5, str);
 321   1              
 322   1              star_postion = 1;
 323   1          printf_str(star_postion, 6, "*");
 324   1          while (1)
 325   1          {
 326   2              /* code */
 327   2                      /* 改star * 的位置 */
 328   2              if (key_scan(key_star) == 0){
 329   3                  printf_str(star_postion, 6, " ");
 330   3                  if (star_postion == 1)
 331   3                      star_postion ++;
 332   3                              else if (star_postion == 2)
 333   3                      star_postion = 1;
 334   3                  printf_str(star_postion, 6, "*");
 335   3              }
 336   2              /* 改值 */
 337   2              if (key_scan(value_up) == 0){
 338   3                  switch (star_postion)
 339   3                  {
 340   4                      case 1:
 341   4                          /* hour */
 342   4                          if(my_beep_time.hour == 23){
 343   5                              my_beep_time.hour = 0;
 344   5                          } else if(my_beep_time.hour < 23){
 345   5                              my_beep_time.hour ++;
 346   5                          }
 347   4                          break;
 348   4                      case 2:
 349   4                      /* minute */
 350   4                          if(my_beep_time.minute == 59){
 351   5                              my_beep_time.minute = 0;
 352   5                          } else if(my_beep_time.minute < 59){
 353   5                              my_beep_time.minute ++;
 354   5                          }
 355   4                          break;
 356   4                      default:
 357   4                          break;
 358   4                  }
 359   3                  /*  */
 360   3                  sprintf(str, "%02d", my_beep_time.hour);
 361   3                  printf_str(1, 5, str);
 362   3                  sprintf(str, "%02d", my_beep_time.minute);
 363   3                  printf_str(2, 5, str);
 364   3              } else if(key_scan(value_down) == 0) {
C51 COMPILER V9.59.0.0   MENU                                                              01/30/2021 00:04:31 PAGE 7   

 365   3                  switch (star_postion)
 366   3                  {
 367   4                      case 1:
 368   4                          if(my_beep_time.hour > 0){
 369   5                              my_beep_time.hour --;
 370   5                          } else if(my_beep_time.hour == 0){
 371   5                              my_beep_time.hour = 23;
 372   5                          }
 373   4                          break;
 374   4                      case 2:
 375   4                          /* minute */
 376   4                          if(my_beep_time.minute > 0){
 377   5                              my_beep_time.minute --;
 378   5                          }
 379   4                          else if(my_beep_time.minute == 0){
 380   5                              my_beep_time.minute = 59;
 381   5                          } 
 382   4                          break;
 383   4                      default:
 384   4                          break;
 385   4                  }
 386   3                  /*  */
 387   3                  sprintf(str, "%02d", my_beep_time.hour);
 388   3                  printf_str(1, 5, str);
 389   3                  sprintf(str, "%02d", my_beep_time.minute);
 390   3                  printf_str(2, 5, str);
 391   3              }
 392   2              if (key_scan(key_break) == 0){
 393   3                 break;
 394   3             }
 395   2          }
 396   1              ET0 = 1; //enable timer1 interrupt
 397   1          EA = 1; //open global interrupt switch
 398   1      }
 399          void menu_list(){
 400   1          if(key_scan(key_break) == 0){
 401   2                  ET0 = 0;        //enable timer1 interrupt
 402   2                              EA = 0;          //open global interrupt switch
 403   2                              lcd_wcmd(0x01);      //清除LCD的显示内容
 404   2                  set_date();
 405   2                              lcd_wcmd(0x01);      //清除LCD的显示内容
 406   2                  
 407   2                  /* 定时函数 */
 408   2                  lcd_wcmd(0x01);      //清除LCD的显示内容
 409   2                  beep_time();
 410   2                  lcd_wcmd(0x01);      //清除LCD的显示内容
 411   2                  //printf_str(0, 2, "当前日期时间");
 412   2          } else if(key_scan(value_up) == 0){
 413   2              /* 第二个按键按下时beep停止 */
 414   2              my_beep_time.is_beeping = 0;
 415   2          }
 416   1      }
 417          
 418          
 419          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =   1897    ----
   CONSTANT SIZE    =     50    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
C51 COMPILER V9.59.0.0   MENU                                                              01/30/2021 00:04:31 PAGE 8   

   DATA SIZE        =     34    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----       1
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
